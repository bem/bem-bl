<div class="shmakowiki"><p>﻿Блок <tt>i-bem</tt> - это блок-хелпер, позволяющий создавать другие блоки. Блок реализован в технологиях <tt>bemhtml</tt> и <tt>js</tt>. Обе эти реализации являются ядром библиотеки блоков в соответствующих технологиях.</p><h2>js-реализация блока i-bem</h2><p>Реализация блока <tt>i-bem</tt> в js обеспечивает хелперы для представления блока в виде js-объекта с определёнными методами и свойствами. Это нужно, чтобы писать клиентский js в терминах БЭМ. То есть js оперирует более высоким уровнем абстрации, чем DOM-представление.</p><p>Для того, чтобы js-представление блока использовало ядро <tt>i-bem</tt>, оно должно быть написано с соблюдением специальных правил.</p><h4>Что описано на этой странице?</h4><ul><li>Какие бывают блоки<ul><li><a href="#dom.blocks">Блоки с DOM-представлением</a></li><li><a href="#abstract.blocks">Блоки без DOM-представления</a></li></ul></li><li>Принципы и особенности подхода<ul><li><a href="#decl">Декларативный принцип</a></li><li><a href="#block.getting">Доступ к другим блокам</a></li><li><a href="#mods">Работа с модификаторами</a></li><li><a href="#customization">Кастомизация блоков</a></li></ul></li><li><a href="#creation">Создание собственного bem-js блока</a></li><li>Подробнее о понятиях<ul><li><a href="#init">Инициализация</a></li><li><a href="#liveinit">Инициализация по требованию (live-инициализация<span>)</span></a></li><li><a href="#finding">Методы доступа к блокам и элементам</a></li><li><a href="#events">Работа с событиями</a></li></ul></li></ul><a name="dom.blocks"></a><h4>Блоки с DOM-представлением</h4><p>Блокам, реализованным на <tt>bem-js</tt>, могут соответствовать ноды в HTML. В этом случае говорится о том, что блоки имеют DOM-представление.<br/> В HTML блоки на bem-js отличаются дополнительным css-классом <tt>i-bem</tt> и специальным форматом записи параметров блока в <tt>onclick</tt>:</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return { &apos;b-my-block&apos; : { name : &apos;b-my-block&apos;}}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span>
...
<span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;/</span>div<span class="ohl-punctuation">&gt;</span></span></code></pre><p>Ниже подробно рассказано о <a href="#onclick.params">формате параметров в onclick</a>.</p><a name="abstract.blocks"></a><h4>Блоки без DOM-представления</h4><p>Технология <tt>bem-js</tt> позволяет также создавать блоки, не имеющие DOM-представления. Такие блоки тем не менее существуют в js в виде объектов, манипулировать ими можно так же, как и блоками с DOM-представлением.</p><p>О том, как создавать такие блоки, написано под заголовком <a href="#dom.decl">Декларация блока</a>.</p><p>Блоки, реализованные на <tt>bem-js</tt>,  после инициализации представлены в js объектами, имеющими свои методы. Эти методы необходимо использовать, если нужно повлиять на внешний вид или поведение блока.<br/> Технология <tt>bem-js</tt> использует предметную область <a href="http://wiki.yandex-team.ru/lento4ka/bem">концепции <tt>BEM</tt></a>. Все сущности являются блоками или их элементами, управление их состояниями реализуется при помощи модификаторов.<br/> Представление блока в js не обязано иметь взаимное соответствие с одной DOM-нодой. Можно разместить несколько блоков на одной DOM-ноде (это называется <tt>mix</tt>), а также реализовать один блок на нескольких DOM-нодах.<br/> Далее блок, использующий технологию <tt>bem-js</tt>, будет называться <tt>блок, реализованный на bem-js</tt>, или <tt>bem-js-блок</tt>. Примером такого блока в библиотеке может служить <tt>b-link</tt>.</p><a name="decl"></a><h2>Декларативный принцип</h2><p>Важной особенностью технологии <tt>bem-js</tt> является декларативный принцип. Подобно работе декларативных языков программирования, js-код содержит не последовательный алгоритм работы блока, а набор действий и условий, при которых эти действия необходимо выполнять.</p><h3>Декларация блока</h3><p>Декларативность проявляется в объявлении того, к каким блокам или их модификациям применим код компонента:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
<span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span></code></pre><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">{</span> <span class="ohl-name">name</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-domik<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modName</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>type<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modVal</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>popup<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
<span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span></code></pre><p><a href="#dom.decl">Подробнее о декларации блока</a></p><a name="mods.reaction"></a><h3>Реакция на изменение модификаторов</h3><p>Согласно концепции, состояния блока или его элементов определяются модификаторами. Поэтому, чтобы динамически изменять состояния блоков и элементов, в <tt>bem-js</tt> есть специальные методы для установки и снятия модификаторов.</p><p>В коде компонента можно записать, как блок или элемент должен отреагировать на изменение модификатора. Эта запись тоже декларативна.<br/> Например, блок <tt>b-dropdowna</tt> при установке модификатора <tt>disabled</tt> прячет показанный попап:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-dropdowna<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>disabled<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-name">modName</span><span class="ohl-punctuation">,</span> <span class="ohl-name">modVal</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">_getSwitcher</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-operator">.</span><span class="ohl-name">setMod</span><span class="ohl-punctuation">(</span><span class="ohl-name">modName</span><span class="ohl-punctuation">,</span> <span class="ohl-name">modVal</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
            <span class="ohl-name">modVal</span> <span class="ohl-operator">==</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>yes<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">&amp;&amp;</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">getPopup</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-operator">.</span><span class="ohl-name">hide</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

        <span class="ohl-punctuation">}</span>

    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
<span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span></code></pre><p>Подробно <a href="#mods.callbacks">о декларации обработки модификаторов</a> рассказано в пункте про создание собственного блока.</p><a name="block.getting"></a><h2>Доступ к другим блокам</h2><p>Может возникнуть необходимость управлять другим блоком. Для любых манипуляций с блоком необходимо получить доступ к js-объекту этого блока и вызывать его методы.</p><a name="blocks.finding"></a><h3>Доступ к bem-js-блоку из другого bem-js-блока.</h3><p>В случае <a href="#creation">реализации собственного кастомного блока на технологии <tt>bem-js</tt></a>, блоку соответствует js-объект. Он наследует общие для всех блоков методы, позволяющие работать с DOM документа в терминах BEM. Среди этих методов есть методы поиска других блоков относительно текущего (<tt>findBlock*</tt>-методы). Они возвращают js-объект искомого блока, что позволяет затем напрямую вызывать его методы.<br/> <b>Не используйте jQuery-селекторы для поиска блоков и элементов.</b></p><p>В этом примере вызывается метод <tt>val()</tt> у блока <tt>b-form-checkbox</tt>:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-checkbox-example<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span><span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span><span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
            <span class="ohl-keyword ohl-keyword-declaration">var</span> <span class="ohl-name">checkbox</span> <span class="ohl-operator">=</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">findBlockInside</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">{</span> <span class="ohl-name">blockName</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-form-checkbox<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modName</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>type<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modVal</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>my-checkbox<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-operator">.</span><span class="ohl-name">append</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>Значение checkbox: <span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">+</span> <span class="ohl-name">checkbox</span><span class="ohl-operator">.</span><span class="ohl-name">val</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-punctuation">}</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><h3>Доступ к bem-js-блоку не из bem-js-блока</h3><p>В случае работы не из bem-js-блока, методы <tt>findBlock*</tt> недоступны. js-объект блока можно получить, используя метод <tt>.bem()</tt> jQuery-коллекции:</p><pre class="ohl ohl-js"><code><span class="ohl-name">$</span><span class="ohl-punctuation">(</span>уникальный селектор<span class="ohl-punctuation">)</span><span class="ohl-operator">.</span><span class="ohl-name">bem</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Этот способ <b>не рекомендован</b>. Лучшим вариантом работы с блоками, реализованными на <tt>i-bem</tt>, является создание собственного компонента на <tt>i-bem</tt>. Подробнее о <a href="#creation">создании собственного bem-js-компонента</a> написано ниже.</p><a name="mods"></a><h2>Работа с модификаторами блока</h2><p>Модификатор задаёт блоку определённое состояние. Каждому блоку можно присвоить один или несколько модификаторов (у блока также может не быть модификаторов вообще). У модификатора есть имя и значение.</p><p>Любой перевод блока в другое состояние должен производиться при помощи установки модификатора. Например, для того, чтобы сделать чекбокс выделенным в блоке <tt>b-form-checkbox</tt>, ему нужно установить модификатор <tt>checked</tt> в значение <tt>yes</tt>.<br/> На странице документации каждого блока есть список его элементов и модификаторов. Из этого списка можно однозначно определять, какие состояния блока доступны для использования.</p><p>Модификаторы нельзя устанавливать, напрямую меняя CSS-класс на соответствующей DOM-ноде. Для корректной работы js все манипуляции с модификаторами должны производиться при помощи метода-хелпера <tt>setMod()</tt>. Также существуют методы <tt>hasMod()</tt>, <tt>getMod</tt>/<tt>getMods()</tt>, <tt>toggleMod()</tt> и <tt>delMod()</tt>. Сигнатуры этих методов доступны в <a href="/blocks/i-bem/i-bem.jsdoc.wiki">референсе по BEM</a>.</p><a name="customization"></a><h2>Изменение поведения существующих блоков</h2><p>Используя <tt>bem-js</tt>, можно переопределять и доопределять методы блока и функций реакции на изменения модификаторов. Это делается аналогично кастомизации блоков на CSS или bemhtml.</p><h3>Переопределение поведения</h3><p>Например, на сервисе существует необходимость модифицировать все блоки <tt>b-dropdowna</tt> так, чтобы они не закрывались по второму клику на псевдо-ссылку. В этом случае на уровне переопределения сервиса нужно сделать файл <tt>blocks/b-dropdowna/b-dropdowna.js</tt>, кастомизирующий поведение блока из библиотеки:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-dropdowna<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">_getSwitcher</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-operator">.</span><span class="ohl-name">on</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>click<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">_on</span><span class="ohl-punctuation">,</span> <span class="ohl-keyword">this</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

        <span class="ohl-punctuation">}</span>
    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
    <span class="ohl-name">_on</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">getPopup</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-operator">.</span><span class="ohl-name">show</span><span class="ohl-punctuation">(</span><span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">elem</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>switcher<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><h3>Расширение поведения</h3><p>В предыдущем примере код кастомизации полностью переопределяет поведение блока. Технология <tt>bem-js</tt> позволяет также реализовывать &quot;доопределение&quot; блока. Для этого в методах кастомизирующего кода можно вызывать <tt>this._<span>_</span>base.apply()</tt>, передавая в качестве аргументов <tt>this</tt> и <tt>arguments</tt>. Вызов такого метода аналогичен использованию <tt>&lt;xsl:apply-imports/&gt;</tt>.</p><p>Например, можно доопределить реакцию на клик всех блоков <tt>b-pseudo-link</tt> на проекте, так, чтобы после первого клика на псевдо-ссылку она приобретала красный цвет.</p><p>Содержание файла <tt>blocks/b-pseudo-link/_is-bem/b-pseudo-link_is-bem_yes.js</tt></p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">{</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>name<span class="ohl-punctuation">&apos;</span></span><span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>modName<span class="ohl-punctuation">&apos;</span></span><span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>is-bem<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>modVal<span class="ohl-punctuation">&apos;</span></span><span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>yes<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
    <span class="ohl-name">_onClick</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
         <span class="ohl-keyword">this</span>
            <span class="ohl-operator">.</span><span class="ohl-name">__base</span><span class="ohl-operator">.</span><span class="ohl-name">apply</span><span class="ohl-punctuation">(</span><span class="ohl-keyword">this</span><span class="ohl-punctuation">,</span> <span class="ohl-name">arguments</span><span class="ohl-punctuation">)</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> выполнить метод _onClick основного b-pseudo-link</span>
            <span class="ohl-operator">.</span><span class="ohl-name">setMod</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>status<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>clicked<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Содержание файла <tt>blocks/b-pseudo-link/_status/b-pseudo-link_status_clicked.css</tt></p><pre class="ohl ohl-xml"><code>.b-pseudo-link_status_clicked
{
    color: red;
}</code></pre><h3>Кастомизация с использованием модификаторов</h3><p>Предыдущие примеры кастомизации изменяют поведение <i>всех</i> определенных блоков на странице. Но очень часто возникает задача кастомизации конкретного блока без влияния на поведение всех таких блоков. Согласно концепции BEM, если блок чем-то отличается от других похожих, это выражается модификатором. Так что нужно реализовывать поведение для блока с таким модификатором.</p><p>Возвращаясь к примеру про псевдо-ссылку, приобретающую красный цвет после первого клика, сделаем модификацию <tt>reaction_odd</tt>. Псевдо-ссылка с таким модификатором приобретает красный цвет после каждого нечётного клика, а после каждого чётного возвращается к исходному цвету .</p><p>Содержание файла <tt>blocks/b-pseudo-link/_reaction/b-pseudo-link_reaction_odd.js</tt>:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">{</span><span class="ohl-name">name</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modName</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>reaction<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>modVal<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>odd<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
    <span class="ohl-name">_onClick</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
         <span class="ohl-keyword">this</span>
            <span class="ohl-operator">.</span><span class="ohl-name">__base</span><span class="ohl-operator">.</span><span class="ohl-name">apply</span><span class="ohl-punctuation">(</span><span class="ohl-keyword">this</span><span class="ohl-punctuation">,</span> <span class="ohl-name">arguments</span><span class="ohl-punctuation">)</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> выполнить метод _onClick основного b-pseudo-link</span>
            <span class="ohl-operator">.</span><span class="ohl-name">toggleMod</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>status<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>clicked<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><a name="creation"></a><h2>Создание js-компонента для собственного блока или собственной модификации</h2><p>Рекомендованным способом работы с bem-js-блоками является создание собственных bem-js-блоков (чаще всего – контейнеров), реагирующих на события других блоков страницы. Собственные <tt>bem-js</tt>-блоки могут вызывать методы других блоков (если нужно) и реализовывать свой функционал.<br/> js-код блока принято размещать в папке блока в файле с именем, соответствующим имени блока, и расширением <tt>.js</tt>. Если js-реализация относится не к блоку, а лишь к одной из его модификаций, можно разместить код в js-файле, соответствующем данному модификатору.</p><a name="dom.decl"></a><h3>Декларация блока</h3><p>Создание js-компонента блока сводится к его декларации с помощью специальных хелперов. Существуют два хелпера для декларации блоков: один для блоков, которые имеют <tt>DOM</tt>-представление, второй – для блоков, не имеющих DOM-представления (например <tt>i-request</tt>, <tt>i-update-session</tt>).</p><p>В первом случае блоки декларируются с помощью <tt>BEM.DOM.decl</tt>, во втором – с помощью <tt>BEM.decl</tt>.</p><p>Хелпер декларации блока принимает 3 параметра:</p><ol><li>Матчащий параметр<br/>
    Первым параметром может быть либо строка с именем
блока, либо хеш. Хеш кроме имени блока содержит дополнительную информацию о том, к какому
типу блоков применять компонент.</li><li>Методы и свойства экземляра блока<br/>
    Методы и свойства, предметной областью которых является конкретный инстанс блока
    на странице. Это как <a href="#mods.callbacks">функции обработки модификаторов</a>,
    так и <a href="#methods">кастомные методы блока</a>.</li><li>Статические методы и свойства<br/>
    Методы и свойства, не относящиеся к конкретному инстансу блока. <a href="#static.methods">Подробнее</a></li></ol><p>Например:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span>
    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> имя блока</span>
    <span class="ohl-punctuation">{</span>
        <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> методы и свойства экземпляра блока</span>
    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
    <span class="ohl-punctuation">{</span>
        <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> статические методы и свойства блока</span>
    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>и</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>i-request<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
    <span class="ohl-punctuation">{</span>
        <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> методы и свойства экземпляра блока</span>
    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
    <span class="ohl-punctuation">{</span>
        <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> статические методы и свойства блока</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Вместо имени блока может быть указано более сложное описание, например, информация о предке:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">{</span> <span class="ohl-name">name</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-dataprovider<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">baseBlock</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>i-request<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">get</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">__base</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> вызов одноименного метода из i-request</span>
        <span class="ohl-name">doSomething</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Тут указано, что блок <tt>b-dataprovider</tt> наследуется от блока <tt>i-request</tt> и переопределяет его метод <tt>get</tt>.</p><p>В первом параметре (хеше) декларации может быть указано не только то, к какому блоку применить компонент, но и уточнён модификатор и/или его значение:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">{</span> <span class="ohl-name">name</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-popup<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modName</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>type<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-name">modVal</span> <span class="ohl-operator">:</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>inplace<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">show</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-name">doSomething</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Все методы, описанные в такой декларации, будут вызываться для таких блоков <tt>b-popup</tt>, которые в данный момент имеют модификатор <tt>type</tt>, установленный в <tt>inplace</tt>.</p><a name="mods.callbacks"></a><h3>Реакция на изменение модификаторов</h3><p>Согласно концепции BEM состояния блоков и его элементов определяются модификаторами. Блок может сам назначать себе или своему элементу модификатор, или получать это назначение из другого блока.<br/> Во время того, как блок или элемент получил определённый модификатор, может возникнуть необходимость отреагировать на установку (или снятие) модификатора.</p><p>Для этого в декларации в части описании методов и свойств экземпляра блока зарезервировано два специальных свойства: <tt>onSetMod</tt> и <tt>onElemSetMod</tt>, где описываются <tt>callback</tt>-функции, вызываемые при установке модификаторов для блока или его элементов.</p><p>Описание <tt>callback</tt>-функций для <tt>onSetMod</tt> представляет собой хеш вида:</p><pre class="ohl ohl-js"><code><span class="ohl-punctuation">{</span>
    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>модификатор1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>значение1-модификатора1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор1&apos; в значение &apos;значение1&apos;</span>

        <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>значениеN-модификатора1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор1&apos; в значение &apos;значениеN&apos;</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>*<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор1&apos; в любое из значений</span>

    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>

    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>модификатор2<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span><span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор2&apos; в любое из значений</span>

    <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>

    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>модификаторN<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>значение1-модификатораN<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>

        <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>значениеN-модификатораN<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span></code></pre><p>Описание <tt>callback</tt>-функций для <tt>onElemSetMod</tt> аналогично, за исключением того, что на верхнем уровне указывается имя элемента:</p><pre class="ohl ohl-js"><code><span class="ohl-punctuation">{</span>

    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>элемент1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>модификатор1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

            <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>значение1-модификатора1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор1&apos; в значение &apos;значение1&apos; для элемента &apos;элемент1&apos;</span>

            <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>

            <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>значениеN-модификатора1<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор1&apos; в значение &apos;значениеN&apos; для элемента &apos;элемент1&apos;</span>

            <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>*<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span> <span class="ohl-punctuation">}</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке модификатора &apos;модификатор1&apos; в любое из значений  для элемента &apos;элемент1&apos;</span>

        <span class="ohl-punctuation">}</span>

    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>

    <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>

    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>элементN<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> функция, которая будет вызвана при установке любого модификатора в любое из значений для элемента &apos;элементN&apos;</span>

<span class="ohl-punctuation">}</span></code></pre><p>Параметры <tt>callback</tt>-функций:</p><ul><li><tt>{jQuery} [elem]</tt> – элемент блока (если установка модификатора была для элемента)</li><li><tt>{String} modName</tt> – имя модификатора</li><li><tt>{String} modVal</tt> – устанавливаемое значение модификатора</li><li><tt>{String} curModVal</tt> – текущее значение модификатора</li></ul><p>Порядок вызовов <tt>callback</tt>-функций при установке модификатора <tt>modVal</tt> в значение <tt>modName</tt>:</p><ul><li>вызывается <tt>callback</tt>-функция на установку любого модификатора в любое значение (если она существует)</li><li>вызывается <tt>callback</tt>-функция на установку модификатора <tt>modVal</tt> в любое значение (если она существует)</li><li>вызывается <tt>callback</tt>-функция на установку модификатора <tt>modVal</tt> в значение <tt>modName</tt> (если она существует)</li></ul><p>Если хоть один из вызовов этих функций вернет <tt>false</tt>, то установки модификатора не произойдет.</p><p>Например:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-menu<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onElemSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>trigger<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

            <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>state<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-name">elem</span><span class="ohl-punctuation">,</span> <span class="ohl-name">modName</span><span class="ohl-punctuation">,</span> <span class="ohl-name">modVal</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

                <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> тут описаны действия, которые нужно совершить при установке элементу &apos;trigger&apos; модификатора с именем &apos;state&apos; в любое значение</span>
                <span class="ohl-keyword">this</span>
                    <span class="ohl-operator">.</span><span class="ohl-name">toggleMod</span><span class="ohl-punctuation">(</span>
                        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">findElem</span><span class="ohl-punctuation">(</span><span class="ohl-name">elem</span><span class="ohl-operator">.</span><span class="ohl-name">closest</span><span class="ohl-punctuation">(</span><span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">buildSelector</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>layout-cell<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>item-content<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-operator">.</span><span class="ohl-name">eq</span><span class="ohl-punctuation">(</span><span class="ohl-number ohl-number-integer">0</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">,</span>
                        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>visibility<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span>
                        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>visible<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span>
                        <span class="ohl-name">modVal</span> <span class="ohl-operator">==</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>opened<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span>
                    <span class="ohl-operator">.</span><span class="ohl-name">trigger</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>trigger<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
                        <span class="ohl-name">domElem</span> <span class="ohl-operator">:</span> <span class="ohl-name">elem</span><span class="ohl-punctuation">,</span>
                        <span class="ohl-name">state</span> <span class="ohl-operator">:</span> <span class="ohl-name">modVal</span>
                    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

            <span class="ohl-punctuation">}</span>

        <span class="ohl-punctuation">}</span>

    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>

    <span class="ohl-name">onTriggerClick</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> при клике на триггер</span>

        <span class="ohl-name">e</span><span class="ohl-operator">.</span><span class="ohl-name">preventDefault</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">toggleMod</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-operator">.</span><span class="ohl-name">data</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>state<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>opened<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> устанавливаем или снимаем значение &apos;opened&apos; у модификатор &apos;state&apos; для элемента &apos;trigger&apos;</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">live</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-keyword">this</span>
            <span class="ohl-operator">.</span><span class="ohl-name">liveBindTo</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>trigger<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>click<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> слушаем live-клик на элементах &apos;trigger&apos;</span>
                <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">onTriggerClick</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
            <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p><tt>В данном примере при вызове </tt>toggleMod<tt> внутри </tt>onTriggerClick<tt> будет вызвана соответствущая ей </tt>callback<tt>-функция из </tt>onElemSetMod<tt>.</tt></p><p>Callback-функции, реагирующие на изменение модификатора, выполняются до установки модификатора. Если существует необходимость выполнить часть кода после установки модификатора, нужно воспользоваться методом <tt>.afterCurrentEvent()</tt>.</p><p>Пример ниже демонстрирует, что квадратик становится больше только после установки модификатора:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-square2<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

            <span class="ohl-keyword ohl-keyword-declaration">var</span> <span class="ohl-name">square</span> <span class="ohl-operator">=</span> <span class="ohl-keyword">this</span><span class="ohl-punctuation">;</span>

            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">bindTo</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>click<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">{</span>
                <span class="ohl-name">square</span><span class="ohl-operator">.</span><span class="ohl-name">setMod</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>size<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>big<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
            <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

        <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>size<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-operator">.</span><span class="ohl-name">append</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>размер1: <span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-operator">.</span><span class="ohl-name">width</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-operator">+</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>&lt;br/&gt;<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> напишет 200</span>

            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">afterCurrentEvent</span><span class="ohl-punctuation">(</span><span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">{</span>
                <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-operator">.</span><span class="ohl-name">append</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>размер2: <span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-operator">.</span><span class="ohl-name">width</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> напишет 400</span>
            <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-punctuation">}</span>
    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><h4>Начало работы с блоком (модификатор <tt>js</tt>)</h4><p>Блок начинает свою работу с действий, описанных в <tt>callback</tt>-функции на установку его модификатора <tt>js</tt> в значение <tt>inited</tt>:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-form-input<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

            <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>inited<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

                <span class="ohl-keyword">this</span>
                    <span class="ohl-operator">.</span><span class="ohl-name">bindTo</span><span class="ohl-punctuation">(</span><span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">elem</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>input<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
                        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>focus<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">onFocus</span><span class="ohl-punctuation">,</span>
                        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>blur<span class="ohl-punctuation">&apos;</span></span>  <span class="ohl-operator">:</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">onBlur</span>
                    <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span>

            <span class="ohl-punctuation">}</span>

        <span class="ohl-punctuation">}</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Этот модификатор присваивается блоку в момент инициализации. Поскольку код обработчика модификатора выполняется до установки модификатора, эта функция-обработчик и является первой выполняющейся функцией блока.</p><p>Модификаторы могут без ограничения присваиваться как блокам, имеющим DOM-представление, так и блокам без него. Так что, у блоков без DOM-представления первый исполняемый метод также задаётся как callback модификатора <tt>js_inited</tt>.</p><p>В коде блоков можно встретить callback-функцию не на значение <tt>inited</tt> модификатора <tt>js</tt>, а на установку модификатора <tt>js</tt> в любое значение:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-form-input<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> конструктор b-form-input</span>
        <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>
        <span class="ohl-punctuation">}</span>

    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Это краткая декларация, возможная из-за того, что до инициализации блок не имеет модификатора <tt>js</tt>, а в момент инциализации приобретает значение <tt>inited</tt>. Другие значения модификатора сейчас не предусмотрены.</p><a name="methods"></a><h3>Методы блока</h3><p>Кроме реакции на модификаторы, в блоке могут быть определены его собственные методы. Определённые в блоке методы могут быть вызваны им самим или другими блоками.</p><p>Например, так выглядит метод <tt>.toggle()</tt> блока <a href="/blocks/b-form-checkbox/b-form/checkbox.wiki">b-form-checkbox</a>:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-form-checkbox<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
    <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>
    <span class="ohl-name">toggle</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">toggleMod</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>checked<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>yes<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span><span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>
    <span class="ohl-operator">.</span><span class="ohl-operator">.</span><span class="ohl-operator">.</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><h4>Переопределение и доопределение методов блока</h4><p>Любой метод блока (в том числе и методы обработки модификаторов) может быть переопределён. Об этом написано выше в пункте <a href="#customization">Изменение поведения существующих блоков</a>.</p><a name="static.methods"></a><h3>Статические методы блока</h3><p>Третий параметр, передаваемый в функцию декларации блока, – это хеш статических методов блока.</p><p>Примером блока, использующего статические методы, может служить <a href="/blocks/b-flash/b-flash.wiki">/blocks/b-flash/b-flash.wiki</a>.</p><p>Для каждого блока может быть определен статический метод <tt>live</tt>, позвляющий реализовать <a href="#liveinit">инициализацию по требованию (liveinit<span>)</span></a>.</p><a name="init"></a><h2>Инициализация</h2><p>Для того, чтобы у блока появился js-объект, описанный в декларации, происходит процесс инициализации блока. Инициализация блоков производится функцией <tt>BEM.DOM.init()</tt> на фрагменте DOM-дерева. Если элемент <tt>i-bem_<span>_</span>dom</tt> задекларирован с модификатором <tt>init_auto</tt> (подключается файл <tt>i-bem_<span>_</span>dom_init_auto.js</tt>), то инициализация блоков происходит на всём документе по событию domReady. Также функцию <tt>BEM.DOM.init</tt> можно вызвать самостоятельно. Например, это делается для инициализации блоков после динамического изменения страницы, если появились новые блоки с js-представлением.</p><h3>Инициализация блоков с DOM-представлением</h3><p>Для инициализации блоков, представленных в DOM, на фрагменте дерева ищутся все блоки, помеченные классом <tt>i-bem</tt>, у них считываются параметры из атрибута onclick, и создаётся js-объект такого блока.</p><a name="onclick.params"></a><h4>Формат параметров блока в onclick</h4><p>Параметры для блока записываются в виде возвращаемого атрибутом <tt>onclick</tt> хеша. Этот хеш должен содержать элементы с названиями, соответствующими названиям блоков, к которым они относятся. Значением каждого элемента должен быть вложенный хеш c параметрами.<br/> Такая запись позволяет задавать параметры для нескольких блоков в том случае, если они представлены в HTML одной и той же DOM-нодой.</p><p>Вот как выглядит DOM-нода произвольного блока, реализованного на <tt>bem-js</tt>:</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return {
    &apos;b-my-block&apos; : {}
}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span>
..
<span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;/</span>div<span class="ohl-punctuation">&gt;</span></span></code></pre><p>В случае, если блоку необходим параметр, он указывается на том же уровне, что и элемент <tt>name</tt>. Формат параметра может быть любым: строка, число, массив, хеш, функция. Количество параметров также не ограничено.</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return {
    &apos;b-my-block&apos; : {
        &apos;points&apos; : [
            [1.67, 2.5],
            [-30, 2.07],
            [290, -0.39]
        ],
        &apos;title&apos; : &apos;Какое-то название&apos;,
    }
}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span>
..
<span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;/</span>div<span class="ohl-punctuation">&gt;</span></span></code></pre><p>Для нескольких блоков на одной DOM-ноде HTML-представление будет аналогично следующему:</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block b-my-second-block i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return {
    &apos;b-my-block&apos; : {
        &apos;title&apos; : &apos;Какое-то название&apos;, // Этот блок имеет опцинальный параметр title
    },
    &apos;b-my-second-block&apos; : {
        // У этого блока нет никаких опциональных параметров
    }
}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span>
..
<span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;/</span>div<span class="ohl-punctuation">&gt;</span></span></code></pre><h4>DOM-представление инициализированного блока</h4><p>После инициализации DOM-представление блока изменяется: у блока появляется дополнительный модификатор <tt>js_inited</tt>.<br/> Если DOM-ноде соответствуют несколько блоков, то появление модификатора у одного из них свидетельствует об инициализации только этого блока и не влияет на инициализацию другого (других).</p><p>DOM-представление блока после инициализации:</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block b-my-block_js_inited i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return {
    &apos;b-my-block&apos; : {
        &apos;name&apos; : &apos;b-my-block&apos;
    }
}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span>
..
<span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;/</span>div<span class="ohl-punctuation">&gt;</span></span></code></pre><p>DOM-представление двух блоков после инициализации:</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block b-my-second-block b-my-block_js_inited b-my-second-block_js_inited i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return {
    &apos;b-my-block&apos; : {
        &apos;name&apos; : &apos;b-my-block&apos;,
    },
    &apos;b-my-second-block&apos; : {
        &apos;name&apos; : &apos;b-my-second-block&apos;
    }
}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span></code></pre><p>DOM-представление двух блоков, но инициализован только один из них:</p><pre class="ohl ohl-xml"><code><span class="ohl-name ohl-name-tag"><span class="ohl-punctuation">&lt;</span>div <span class="ohl-name ohl-name-attribute">class<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>b-my-block b-my-second-block b-my-second-block_js_inited i-bem<span class="ohl-punctuation">&quot;</span></span></span> <span class="ohl-name ohl-name-attribute">onclick<span class="ohl-punctuation">=</span><span class="ohl-string ohl-string-double"><span class="ohl-punctuation">&quot;</span>return {
    &apos;b-my-block&apos; : {
        &apos;name&apos; : &apos;b-my-block&apos;,
    },
    &apos;b-my-second-block&apos; : {
        &apos;name&apos; : &apos;b-my-second-block&apos;
    }
}<span class="ohl-punctuation">&quot;</span></span></span><span class="ohl-punctuation">&gt;</span></span></code></pre><h3>Инициализация блоков без DOM-представления</h3><p>В том случае, если у блока нет DOM-представления, в процессе инициализации просто возникает js-объект, соответствующий этому блоку. Дальнейшее зависит от кода блока.</p><a name="liveinit"></a><h2>Инициализация по требованию (liveInit)</h2><p>Многим блокам (например, <tt>b-pseudo-link</tt>, <tt>b-dropdown</tt>, <tt>b-smart-help</tt>) нет необходимости делать сразу же полную инициализацию. Инициализация может происходить только на ключевые события для этого блока, например, клик по элементу этого блока. Рассмотрим на примере блока <tt>b-pseudo-link</tt>:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">_onClick</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-name">e</span><span class="ohl-operator">.</span><span class="ohl-name">preventDefault</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">trigger</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>click<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">live</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">liveBindTo</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>click<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
            <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">_onClick</span><span class="ohl-punctuation">(</span><span class="ohl-name">e</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>В статических свойствах блока предусмотрено специальное свойство <tt>live</tt> (<tt>Function</tt>|<tt>Boolean</tt>), отвечающее за инициализацию по требованию и за подписку на <tt>live</tt>-события на <tt>DOM</tt>-элементах внутри такого блока.</p><p>Если <tt>live</tt> определено как <tt>Function</tt>, то эта функция будет выполнена один раз – при попытке инициализации первого такого блока.</p><p>Существует несколько хелперов для live-событий:</p><ul><li><tt>liveInitOnEvent</tt> – хелпер для инициализации блока по событию на блоке или его внутреннем элементе</li><li><tt>liveBindTo</tt> – подписка на события на блоке или его внутреннем элементе</li></ul><p>Оба этих хелпера инициализируют блок при возникновении первого такого события. Различие же заключается в том, что <tt>callback</tt>-функция в <tt>liveInitOnEvent</tt> вызывается только один раз после инициализации блока, а в <tt>liveBindTo</tt> она будет вызываться при каждом событии. Контекстом такой <tt>callback</tt>-функции является тот блок, в котором произошло событие.</p><p>В вышеприведенном примере блок <tt>b-pseudo-link</tt> будет инициализирован при первом клике на себе и будет реагировать на каждый последующий клик.</p><p>Если же <tt>live</tt> определено как <tt>Boolean</tt> и установлено в <tt>true</tt>, то такой блок будет инициализирован только при попытке доступа к нему, например, из методов поиска <tt>findBlockInside</tt>/<tt>findBlockOutside</tt>.</p><p>&lt;a name=&quot;finding&quot;&gt;&lt;/a&gt;</p><h2>Методы доступа к блокам и элементам</h2><p>Работая с блоками, реализованными на <tt>bem-js</tt>, необходимо использовать встроенные методы для поиска блоков и их элементов. Эти методы доступны в каждом блоке и умеют возвращать другой блок или jQuery-коллекцию (в случае поиска элементов).</p><h3>Методы поиска блоков</h3><p>Поиск блоков осуществляется относительно текущего блока при помощи методов <tt>findBlock*</tt>.</p><p>Реализуем блок <tt>b-my-block</tt>, который находит первый из блоков <tt>b-form-checkbox</tt> внутри себя и вызывает у него метод <tt>toggle()</tt> для переключения чекбокса.</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-my-block<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>
    <span class="ohl-name">onSetMod</span> <span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
            <span class="ohl-keyword ohl-keyword-declaration">var</span> <span class="ohl-name">checkbox</span> <span class="ohl-operator">=</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">findBlockInside</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-form-checkbox<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
            <span class="ohl-name">checkbox</span><span class="ohl-operator">.</span><span class="ohl-name">toggle</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-punctuation">}</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Поиск блока или блоков может быть выполнен одним из следующих методов:</p><ul><li>findBlockInside/findBlocksInside – поиск блока/блоков внутри DOM-элементов текущего блока или его элементов</li><li>findBlockOn/findBlocksOn – поиск блока/блоков на DOM-элементах текущего блока или его элементов</li><li>findBlockOutside/findBlocksOutside – поиск блока/блоков снаружи DOM-элементов текущего блока или его элементов</li></ul><p>Список методов поиска блоков и их сигнатуры можно посмотреть в <a href="/blocks/i-bem/dom/i-bem__dom.jsdoc.wiki">референсе по BEM.DOM</a>.</p><p>Примерами блоков, использующих методы поиска других блоков, могут быть: <a href="/blocks/b-smart-help/b-smart-help.wiki">b-smart-help</a>, <a href="blocks/b-screenshot/b-screenshot.wiki">b-screenshot</a> и <a href="blocks/b-dropdowna/b-dropdowna.wiki">b-dropdowna</a>.</p><h3>Методы доступа к элементам</h3><p>Для поиска элементов внутри блока используется метод <tt>elem</tt>. Результат этого метода кэшируется.</p><p>Например:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-form-input<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">doSomething</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">elem</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>hint<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> тут будут найдены элементы b-form-input__hint</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Можно искать элементы внутри блока с учетом модификатора:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-menu<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">doSomething</span> <span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>

        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">elem</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>item<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>state<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>current<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span> <span class="ohl-comment ohl-comment-single"><span class="ohl-punctuation">//</span> тут будут найдены элементы b-menu__item_state_current</span>

    <span class="ohl-punctuation">}</span>

<span class="ohl-punctuation">}</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Некэширующий метод поиска элементов называется <tt>findElem()</tt>.</p><p>Полный список методов для поиска элементов и их сигнатуры можно найти в <a href="/blocks/i-bem/dom/i-bem__dom.jsdoc.wiki">референсе по BEM.DOM</a>.</p><a name="events"></a><h2>Работа с событиями</h2><h3>События на блоках</h3><p>Блоки предоставляют интерфейс для подписки/отписки/нотификации своих собственных (не DOM) событий:</p><ul><li><tt>on(e, [data], fn, [ctx])</tt> – подписка на событие <tt>e</tt></li><li><tt>onFirst(e, [data], fn, [ctx])</tt> – подписка только на первое событие <tt>e</tt></li><li><tt>un([e], [fn], [ctx])</tt> – отписка от конкретного события <tt>e</tt> или всех событий</li><li><tt>trigger(e, [data])</tt> – нотификация о событии  <tt>e</tt></li></ul><h3>live-события на блоках</h3><p>В <tt>bem-js</tt> есть события, реализованные по паттерну делегированных событий, они называются <tt>live-события</tt>.</p><p>Следующий пример демонстрирует работу с live-событием <tt>click</tt> для блоков <tt>b-pseudo-link</tt>, содержащихся в определённой DOM-ноде. В данном случае контейнер и блок совпадают:</p><pre class="ohl ohl-js"><code><span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">DOM</span><span class="ohl-operator">.</span><span class="ohl-name">decl</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link-example<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span> <span class="ohl-punctuation">{</span>

    <span class="ohl-name">onSetMod</span><span class="ohl-operator">:</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>js<span class="ohl-punctuation">&apos;</span></span><span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
            <span class="ohl-keyword ohl-keyword-declaration">var</span> <span class="ohl-name">link</span> <span class="ohl-operator">=</span> <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">findBlockInside</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
            <span class="ohl-name">BEM</span><span class="ohl-operator">.</span><span class="ohl-name">blocks</span><span class="ohl-punctuation">[</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">]</span>
                <span class="ohl-operator">.</span><span class="ohl-name">liveCtxBind</span><span class="ohl-punctuation">(</span><span class="ohl-name">link</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-punctuation">,</span>
                            <span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>click<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">,</span>
                            <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">{</span>
                                <span class="ohl-name">link</span><span class="ohl-operator">.</span><span class="ohl-name">domElem</span><span class="ohl-operator">.</span><span class="ohl-name">text</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>Кликнутая ссылка<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
                            <span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
                            <span class="ohl-keyword">this</span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
        <span class="ohl-punctuation">}</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span><span class="ohl-punctuation">,</span>
<span class="ohl-punctuation">{</span>
    <span class="ohl-name">live</span><span class="ohl-operator">:</span> <span class="ohl-keyword ohl-keyword-declaration">function</span><span class="ohl-punctuation">(</span><span class="ohl-punctuation">)</span> <span class="ohl-punctuation">{</span>
        <span class="ohl-keyword">this</span><span class="ohl-operator">.</span><span class="ohl-name">liveInitOnBlockInsideInit</span><span class="ohl-punctuation">(</span><span class="ohl-string ohl-string-single"><span class="ohl-punctuation">&apos;</span>b-pseudo-link<span class="ohl-punctuation">&apos;</span></span><span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span>
    <span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">}</span>
<span class="ohl-punctuation">)</span><span class="ohl-punctuation">;</span></code></pre><p>Метод <tt>.liveCtxBind()</tt> реализует возможность реакции на bem-события блоков, вложенных в какой-либо DOM-элемент. <b>Это не DOM-события</b><br/> Использование <tt>live-событий</tt> позволяет избежать лишнего поиска блоков в DOM-дереве. Кроме того, при такой привязке к событию реакция на событие блока из контейнера будет происходить даже в том случае, если на момент привязки блока в контейнере не было, а он появился позже в результате динамического изменения документа.</p><p>Кроме возможности привязки к live-событию блока, здесь также продемонстрированы <a href="#blocks.finding">поиск блока относительно текущего</a> и <a href="#liveinit">live-инициалиация</a>.<br/></p></div>
